steps:
  - name: 'python:3.10'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        cp requirements.txt ${_FUNCTION_PATH} && \
        mkdir ${_FUNCTION_PATH}src && \
        cp -r src/common ${_FUNCTION_PATH}src && \
        cp -r src/config ${_FUNCTION_PATH}src


  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        cd ${_FUNCTION_PATH} && \
        gcloud functions deploy ${_FUNCTION_NAME} \
        --gen2 \
        --runtime python310 \
        --trigger-http \
        --no-allow-unauthenticated \
        --region southamerica-east1 \
        --memory 512MB \
        --timeout 3600
        --source . \
        --entry-point ${_FUNCTION_NAME} \
        --service-account data-lake-v2@datalake-v2-424516.iam.gserviceaccount.com \
        --run-service-account data-lake-v2@datalake-v2-424516.iam.gserviceaccount.com


timeout: 900s  # 15 minutes for the build to complete
options:
  logging: CLOUD_LOGGING_ONLY